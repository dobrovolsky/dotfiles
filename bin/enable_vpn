#!/usr/bin/expect

#This script connects to cisco anyconnect vpn with MFA with
# https://github.com/dlenski/python-vipaccess
# Put password to ~/.vpn_password and host of vpn to ~/.vpn_host

set timeout 60

set vip_code [exec ~/.pyenv/shims/vipaccess]
set pass [exec cat $::env(HOME)/.vpn_password]
set server [exec cat $::env(HOME)/.vpn_host]

eval spawn /opt/cisco/anyconnect/bin/vpn connect $server

expect "2)" { send "2\r" }
expect "Username: " { send "\r" }
expect "Password: " { send $pass\r" }
expect "Second "    { send "$vip_code\r" }
expect "accept? "   { send "y\r" }

expect "VPN>"

exit